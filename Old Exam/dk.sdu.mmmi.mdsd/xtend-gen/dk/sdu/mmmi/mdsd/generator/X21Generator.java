/**
 * generated by Xtext 2.26.0
 */
package dk.sdu.mmmi.mdsd.generator;

import com.google.common.collect.Iterables;
import com.google.common.collect.Iterators;
import dk.sdu.mmmi.mdsd.x21.DataDecl;
import dk.sdu.mmmi.mdsd.x21.X21;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.xtend2.lib.StringConcatenation;
import org.eclipse.xtext.generator.AbstractGenerator;
import org.eclipse.xtext.generator.IFileSystemAccess2;
import org.eclipse.xtext.generator.IGeneratorContext;
import org.eclipse.xtext.xbase.lib.StringExtensions;

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
@SuppressWarnings("all")
public class X21Generator extends AbstractGenerator {
  @Override
  public void doGenerate(final Resource resource, final IFileSystemAccess2 fsa, final IGeneratorContext context) {
    X21 program = Iterators.<X21>filter(resource.getAllContents(), X21.class).next();
    String packageName = program.getName().toLowerCase();
    Iterable<DataDecl> customDataTypes = Iterables.<DataDecl>filter(program.getDeclarations(), DataDecl.class);
    DataTypeGenerator typeGenerator = new DataTypeGenerator();
    for (final DataDecl dataType : customDataTypes) {
      {
        StringConcatenation _builder = new StringConcatenation();
        _builder.append("Data");
        String _firstUpper = StringExtensions.toFirstUpper(dataType.getName());
        _builder.append(_firstUpper);
        String dataClassName = _builder.toString();
        typeGenerator.setDeclaration(dataType);
        StringConcatenation _builder_1 = new StringConcatenation();
        _builder_1.append(packageName);
        _builder_1.append("/");
        _builder_1.append(dataClassName);
        _builder_1.append(".java");
        fsa.generateFile(_builder_1.toString(), typeGenerator.genJavaCode(packageName));
      }
    }
    StringConcatenation _builder = new StringConcatenation();
    String _name = program.getName();
    _builder.append(_name);
    _builder.append("Main");
    String className = _builder.toString();
    MainFileGenerator mainGenerator = new MainFileGenerator(packageName, className, program);
    StringConcatenation _builder_1 = new StringConcatenation();
    _builder_1.append(packageName);
    _builder_1.append("/");
    _builder_1.append(className);
    _builder_1.append(".java");
    fsa.generateFile(_builder_1.toString(), mainGenerator.genJavaCode());
  }
}
